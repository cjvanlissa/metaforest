<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Conduct a MetaForest analysis to explore heterogeneity in meta-analytic data. — MetaForest • metaforest</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Conduct a MetaForest analysis to explore heterogeneity in meta-analytic data. — MetaForest" />
<meta property="og:description" content="MetaForest uses a weighted random forest to explore heterogeneity in
meta-analytic data. MetaForest is a wrapper for ranger
(Wright &amp;amp; Ziegler, 2015). As input, MetaForest takes the study effect sizes
and their variances (these can be computed, for example, using the
metafor package), as well as the moderators
that are to be included in the model. By default, MetaForest uses
random-effects weights, and estimates the between-studies variance using a
restricted maximum-likelihood estimator. However, it may be beneficial to
first conduct an unweighted MetaForest, and then use the estimated residual
heterogeneity from this model as the estimate of tau2 for a
random-effects weighted MetaForest." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">metaforest</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Introduction_to_metaforest.html">Introduction to metaforest</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Conduct a MetaForest analysis to explore heterogeneity in meta-analytic data.</h1>
    
    <div class="hidden name"><code>MetaForest.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>MetaForest uses a weighted random forest to explore heterogeneity in
meta-analytic data. MetaForest is a wrapper for <a href='https://rdrr.io/pkg/ranger/man/ranger.html'>ranger</a>
(Wright &amp; Ziegler, 2015). As input, MetaForest takes the study effect sizes
and their variances (these can be computed, for example, using the
<code><a href='https://rdrr.io/pkg/metafor/man/rma.uni.html'>metafor</a></code> package), as well as the moderators
that are to be included in the model. By default, MetaForest uses
random-effects weights, and estimates the between-studies variance using a
restricted maximum-likelihood estimator. However, it may be beneficial to
first conduct an unweighted MetaForest, and then use the estimated residual
heterogeneity from this model as the estimate of <code>tau2</code> for a
random-effects weighted MetaForest.</p>
    </div>

    <pre class="usage"><span class='fu'>MetaForest</span>(
  <span class='no'>formula</span>,
  <span class='no'>data</span>,
  <span class='kw'>vi</span> <span class='kw'>=</span> <span class='st'>"vi"</span>,
  <span class='kw'>study</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>whichweights</span> <span class='kw'>=</span> <span class='st'>"random"</span>,
  <span class='kw'>num.trees</span> <span class='kw'>=</span> <span class='fl'>500</span>,
  <span class='kw'>mtry</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"REML"</span>,
  <span class='kw'>tau2</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>Formula. Specify a formula for the MetaForest model, for
example, <code>yi ~ .</code> to predict the outcome <code>yi</code> from all moderators
in the data. Only additive formulas are allowed (i.e., <code>x1+x2+x3</code>).
Interaction terms and non-linear terms are not required, as the random
forests algorithm inherently captures these associations.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>A data.frame containing the effect size, moderators, and the
variance of the effect size.</p></td>
    </tr>
    <tr>
      <th>vi</th>
      <td><p>Character. Specify the name of the column in the <code>data</code> that
contains the variances of the effect sizes. This column will be removed from
the data prior to analysis. Defaults to <code>"vi"</code>.</p></td>
    </tr>
    <tr>
      <th>study</th>
      <td><p>Character. Optionally, specify the name of the column in the
<code>data</code> that contains the study id. Use this when the data includes
multiple effect sizes per study. This column can be a vector of integers, or
a factor. This column will be removed from the data prior to analysis.
See <code>Details</code> for more information about analyzing dependent data.</p></td>
    </tr>
    <tr>
      <th>whichweights</th>
      <td><p>Character. Indicate what time of weights are required.
A random-effects MetaForest is grown by specifying <code>whichweights =
"random"</code>. A fixed-effects MetaForest is grown by specifying
<code>whichweights = "fixed"</code>. An unweighted MetaForest is grown by
specifying <code>whichweights = "unif"</code>. Defaults to <code>"random"</code>.</p></td>
    </tr>
    <tr>
      <th>num.trees</th>
      <td><p>Atomic integer. Specify the number of trees in the forest.
Defaults to 500.</p></td>
    </tr>
    <tr>
      <th>mtry</th>
      <td><p>Atomic integer. Number of candidate moderators available for each
split. Defaults to the square root of the number moderators (rounded down).</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>Character. Specify the method by which to estimate the residual
variance. Can be set to one of the following: "DL", "HE", "SJ", "ML", "REML",
"EB", "HS", or "GENQ". Default is "REML". See the
<code><a href='https://rdrr.io/pkg/metafor/man/rma.uni.html'>metafor</a></code> package for more information about
these estimators.</p></td>
    </tr>
    <tr>
      <th>tau2</th>
      <td><p>Numeric. Specify a predetermined value for the residual
heterogeneity. Entering a value here supersedes the estimated tau2 value.
Defaults to NULL.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments are passed directly to <a href='https://rdrr.io/pkg/ranger/man/ranger.html'>ranger</a>.
It is recommended not to use additional arguments.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>List of length 3. The "forest" element of this list is an object of
class "ranger", containing the results of the random forests analysis. The
"rma_before" element is an object of class "rma.uni", containing the results
of a random-effects meta-analysis on the raw data, without moderators. The
"rma_after" element is an object of class "rma.uni", containing the results
of a random-effects meta-analysis on the residual heterogeneity, or the
difference between the effect sizes predicted by MetaForest and the observed
effect sizes.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>For dependent data, a clustered MetaForest analysis is more
appropriate. This is because the predictive performance of a MetaForest
analysis is evaluated on out-of-bootstrap cases, and when cases out of the
bootstrap sample originate from the same study, the model will be overly
confident in its ability to predict their value. When the MetaForest is
clustered by the <code>study</code> variable, the dataset is first split into two
cross-validation samples by study. All dependent effect sizes from each study
are thus included in the same cross-validation sample. Then, two random
forests are grown on these cross-validation samples, and for each random
forest, the other sample is used to calculate prediction error and variable
importance (see <a href='http://doi.org/10.1007/s11634-016-0276-4'>Janitza,
Celik, &amp; Boulesteix, 2016</a>).</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>#Example 1:</span>
<span class='co'>#Simulate data with a univariate linear model</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>42</span>)
<span class='no'>data</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='SimulateSMD.html'>SimulateSMD</a></span>()
<span class='co'>#Conduct unweighted MetaForest analysis</span>
<span class='no'>mf.unif</span> <span class='kw'>&lt;-</span> <span class='fu'>MetaForest</span>(<span class='kw'>formula</span> <span class='kw'>=</span> <span class='no'>yi</span> ~ <span class='no'>.</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>data</span>$<span class='no'>training</span>,
                      <span class='kw'>whichweights</span> <span class='kw'>=</span> <span class='st'>"unif"</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"DL"</span>)
<span class='co'>#Print model</span>
<span class='no'>mf.unif</span></div><div class='output co'>#&gt; Call:
#&gt; MetaForest(formula = yi ~ ., data = data$training, whichweights = "unif", 
#&gt;     method = "DL")
#&gt; 
#&gt; R squared (OOB):                  0.2768 
#&gt; Residual heterogeneity (tau2):    0.0120 </div><div class='input'><span class='co'>#Conduct random-effects weighted MetaForest analysis</span>
<span class='no'>mf.random</span> <span class='kw'>&lt;-</span> <span class='fu'>MetaForest</span>(<span class='kw'>formula</span> <span class='kw'>=</span> <span class='no'>yi</span> ~ <span class='no'>.</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='no'>data</span>$<span class='no'>training</span>,
                        <span class='kw'>whichweights</span> <span class='kw'>=</span> <span class='st'>"random"</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"DL"</span>,
                        <span class='kw'>tau2</span> <span class='kw'>=</span> <span class='fl'>0.0116</span>)
<span class='co'>#Print summary</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mf.random</span>)</div><div class='output co'>#&gt; MetaForest results
#&gt;                                          
#&gt; Type of analysis:              MetaForest
#&gt; Number of studies:             20        
#&gt; Number of moderators:          5         
#&gt; Number of trees in forest:     500       
#&gt; Candidate variables per split: 2         
#&gt; Minimum terminal node size:    5         
#&gt; OOB prediction error (MSE):    0.0925    
#&gt; R squared (OOB):               0.3576    
#&gt; 
#&gt; Tests for Heterogeneity: 
#&gt;                                tau2   tau2_SE I^2     H^2    Q-test  df Q_p   
#&gt; Raw effect sizes:              0.0553 0.0486  37.2642 1.5940 30.2857 19 0.0483
#&gt; Residuals (after MetaForest):  0.0000 0.0302  0.0000  1.0000 18.9321 19 0.4612
#&gt; 
#&gt; 
#&gt; Random intercept meta-analyses:
#&gt;                                Intercept se     ci.lb   ci.ub   p     
#&gt; Raw effect sizes:              -0.2136   0.0875 -0.3851 -0.0421 0.0147
#&gt; Residuals (after MetaForest):  0.0327    0.0680 -0.1005 0.1660  0.6300</div><div class='input'>
<span class='co'>#Example 2: Real data from metafor</span>
<span class='co'>#Load and clean data</span>
<span class='no'>data</span> <span class='kw'>&lt;-</span> <span class='no'>dat.bangertdrowns2004</span>
<span class='no'>data</span>[, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>4</span>:<span class='fl'>12</span>)] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/apply.html'>apply</a></span>(<span class='no'>data</span>[ , <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>4</span>:<span class='fl'>12</span>)], <span class='fl'>2</span>, <span class='kw'>function</span>(<span class='no'>x</span>){
  <span class='no'>x</span>[<span class='fu'><a href='https://rdrr.io/r/base/NA.html'>is.na</a></span>(<span class='no'>x</span>)] <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/median.html'>median</a></span>(<span class='no'>x</span>, <span class='kw'>na.rm</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)
  <span class='no'>x</span>})
<span class='no'>data</span>$<span class='no'>subject</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='no'>data</span>$<span class='no'>subject</span>)
<span class='no'>data</span>$<span class='no'>yi</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='no'>data</span>$<span class='no'>yi</span>)
<span class='co'>#Conduct MetaForest analysis</span>
<span class='no'>mf.bd2004</span> <span class='kw'>&lt;-</span> <span class='fu'>MetaForest</span>(<span class='kw'>formula</span> <span class='kw'>=</span> <span class='no'>yi</span>~ <span class='no'>grade</span> + <span class='no'>length</span> + <span class='no'>minutes</span> + <span class='no'>wic</span>+
                               <span class='no'>meta</span>, <span class='no'>data</span>, <span class='kw'>whichweights</span> <span class='kw'>=</span> <span class='st'>"unif"</span>)
<span class='co'>#Print MetaForest object</span>
<span class='no'>mf.bd2004</span></div><div class='output co'>#&gt; Call:
#&gt; MetaForest(formula = yi ~ grade + length + minutes + wic + meta, 
#&gt;     data = data, whichweights = "unif")
#&gt; 
#&gt; R squared (OOB):                  0.0887 
#&gt; Residual heterogeneity (tau2):    0.0672 </div><div class='input'><span class='co'>#Check convergence plot</span>
<span class='fu'><a href='https://rdrr.io/r/base/plot.html'>plot</a></span>(<span class='no'>mf.bd2004</span>)</div><div class='img'><img src='MetaForest-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'>#Check summary</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span>(<span class='no'>mf.bd2004</span>, <span class='kw'>digits</span> <span class='kw'>=</span> <span class='fl'>4</span>)</div><div class='output co'>#&gt; MetaForest results
#&gt;                                          
#&gt; Type of analysis:              MetaForest
#&gt; Number of studies:             48        
#&gt; Number of moderators:          5         
#&gt; Number of trees in forest:     500       
#&gt; Candidate variables per split: 2         
#&gt; Minimum terminal node size:    5         
#&gt; OOB prediction error (MSE):    0.1426    
#&gt; R squared (OOB):               0.0887    
#&gt; 
#&gt; Tests for Heterogeneity: 
#&gt;                                tau2   tau2_SE I^2     H^2    Q-test   df Q_p   
#&gt; Raw effect sizes:              0.0499 0.0197  58.3740 2.4023 107.1061 47 0.0000
#&gt; Residuals (after MetaForest):  0.0672 0.0238  65.3486 2.8859 129.8299 47 0.0000
#&gt; 
#&gt; 
#&gt; Random intercept meta-analyses:
#&gt;                                Intercept se     ci.lb   ci.ub  p     
#&gt; Raw effect sizes:              0.2219    0.0460 0.1317  0.3122 0.0000
#&gt; Residuals (after MetaForest):  -0.0361   0.0502 -0.1345 0.0624 0.4726</div><div class='input'><span class='co'>#Examine variable importance plot</span>
<span class='fu'><a href='VarImpPlot.html'>VarImpPlot</a></span>(<span class='no'>mf.bd2004</span>)</div><div class='img'><img src='MetaForest-2.png' alt='' width='700' height='433' /></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Caspar J. van Lissa.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


