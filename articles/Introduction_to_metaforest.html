<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to metaforest • metaforest</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to metaforest">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">metaforest</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Introduction_to_metaforest.html">Introduction to metaforest</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/cjvanlissa/metaforest/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to metaforest</h1>
                        <h4 data-toc-skip class="author">Caspar J. van
Lissa</h4>
            
            <h4 data-toc-skip class="date">2025-07-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/cjvanlissa/metaforest/blob/master/vignettes/Introduction_to_metaforest.Rmd" class="external-link"><code>vignettes/Introduction_to_metaforest.Rmd</code></a></small>
      <div class="d-none name"><code>Introduction_to_metaforest.Rmd</code></div>
    </div>

    
    
<p><strong>This Vignette is based on the Open-Access book
chapter:</strong></p>
<p>Van Lissa, C. J. (2020). Small sample meta-analyses: Exploring
heterogeneity using MetaForest. In R. Van De Schoot &amp; M. Miočević
(Eds.), <em>Small Sample Size Solutions (Open Access): A Guide for
Applied Researchers and Practitioners.</em> CRC Press. <a href="https://doi.org/10.4324/9780429273872-16" class="external-link uri">https://doi.org/10.4324/9780429273872-16</a></p>
<p><strong>Please refer to that chapter for a more in-depth explanation,
and please cite the chapter.</strong></p>
<p>One of the most common applications of meta-analysis in the social
sciences is to summarize a body of literature on a specific topic. The
literature typically covers similar research questions, investigated in
different laboratories, using different methods, instruments, and
samples. We typically do not know beforehand which of these moderators
will affect the effect size found. MetaForest is a machine-learning
based, exploratory approach to identify relevant moderators in
meta-analysis. MetaForest is an adaptation of the random forests
algorithm for meta-analysis: Weighted bootstrap sampling is used to
ensure that more precise studies exert greater influence in the model
building stage. These weights can be uniform (each study has equal
probability of being selected into the bootstrap sample), fixed-effects
(studies with smaller sampling variance have a larger probability of
being selected), or random-effects based (studies with smaller sampling
variance have a larger probability of being selected, but this advantage
is diminished as the amount of between-studies heterogeneity increases).
Internally, <code>metaforest</code> relies on the <code>ranger</code>
R-package; a fast implementation of the random forests in C++.</p>
<div class="section level2">
<h2 id="tutorial-example">Tutorial example<a class="anchor" aria-label="anchor" href="#tutorial-example"></a>
</h2>
<p>To illustrate how to use MetaForest, I will re-analyze the published
work of Fukkink and Lont (2007), who have graciously shared their data.
The authors examined the effectiveness of training on the competency of
childcare providers. The sample is small, consisting of 78 effect sizes
derived from 17 unique samples.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install the metaforest package. This needs to be done only once.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"metaforest"</span><span class="op">)</span></span>
<span><span class="co"># Then, load the metaforest package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cjvanlissa.github.io/metaforest/">metaforest</a></span><span class="op">)</span></span>
<span><span class="co"># Assign the fukkink_lont data, which is included in</span></span>
<span><span class="co"># the metaforest package, to an object called "data"</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">fukkink_lont</span></span>
<span><span class="co"># Because MetaForest uses the random number generator (for bootstrapping),</span></span>
<span><span class="co"># we set a random seed so analyses can be replicated exactly.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">62</span><span class="op">)</span></span></code></pre></div>
<p>First, check model convergence by examining the cumulative mean
squared out-of-bag prediction error (MSE) as a function of the number of
trees in the model. When the MSE stabilizes, the model is said to have
converged.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run model with many trees to check convergence</span></span>
<span><span class="va">check_conv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MetaForest.html">MetaForest</a></span><span class="op">(</span><span class="va">yi</span><span class="op">~</span><span class="va">.</span>,</span>
<span>                        data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                        study <span class="op">=</span> <span class="st">"id_exp"</span>,</span>
<span>                        whichweights <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>                        num.trees <span class="op">=</span> <span class="fl">20000</span><span class="op">)</span></span>
<span><span class="co"># Plot convergence trajectory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">check_conv</span><span class="op">)</span></span></code></pre></div>
<p>This model has converged within approximately 5000 trees. Thus, we
will use this number of trees for subsequent analyses. We now apply
recursive pre-selection using the <code>preselect</code> function. Using
<code>preselect_vars</code>, we retain only those moderators for which a
50% percentile interval of the variable importance metrics does not
include zero.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Model with 5000 trees for replication</span></span>
<span><span class="va">mf_rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MetaForest.html">MetaForest</a></span><span class="op">(</span><span class="va">yi</span><span class="op">~</span><span class="va">.</span>,</span>
<span>                        data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                        study <span class="op">=</span> <span class="st">"id_exp"</span>,</span>
<span>                        whichweights <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>                        num.trees <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span></span>
<span><span class="co"># Run recursive preselection, store results in object 'preselect'</span></span>
<span><span class="va">preselected</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/preselect.html">preselect</a></span><span class="op">(</span><span class="va">mf_rep</span>,</span>
<span>                         replications <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                         algorithm <span class="op">=</span> <span class="st">"recursive"</span><span class="op">)</span></span>
<span><span class="co"># Plot the results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">preselected</span><span class="op">)</span></span>
<span><span class="co"># Retain only moderators with positive variable importance in more than</span></span>
<span><span class="co"># 50% of replications</span></span>
<span><span class="va">retain_mods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/preselect_vars.html">preselect_vars</a></span><span class="op">(</span><span class="va">preselected</span>, cutoff <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="tuning-parameters">Tuning parameters<a class="anchor" aria-label="anchor" href="#tuning-parameters"></a>
</h3>
<p>MetaForest has several “tuning parameters”, whose optimal values must
be determined empirically: 1) the number of candidate variables
considered at each split of each tree; 2) the minimum number of cases
that must remain in a post-split group within each tree; 3) the type of
weights (uniform, fixed-, or random-effects). The optimal values for
these tuning parameters are commonly determined using cross-validation,
with the well-known machine learning R-package <code>caret</code>.</p>
<p>Next, we tune the model using the R-package <code>caret</code>. The
function <code>ModelInfo_mf</code> tells caret how to tune a MetaForest
analysis. As tuning parameters, we consider all three types of weights
(uniform, fixed-, and random-effects), number of candidate variables at
each split from 2-6, and a minimum node size from 2-6. We select the
model with smallest prediction error (RMSE) as final model, based on
10-fold clustered cross-validation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load the caret library</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/" class="external-link">caret</a></span><span class="op">)</span></span>
<span><span class="co"># Set up 10-fold grouped (=clustered) CV</span></span>
<span><span class="va">grouped_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html" class="external-link">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, </span>
<span>                           index <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/createDataPartition.html" class="external-link">groupKFold</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">id_exp</span>, k <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up a tuning grid for the three tuning parameters of MetaForest</span></span>
<span><span class="va">tuning_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>whichweights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"random"</span>, <span class="st">"fixed"</span>, <span class="st">"unif"</span><span class="op">)</span>,</span>
<span>                       mtry <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">6</span>,</span>
<span>                       min.node.size <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># X should contain only retained moderators, clustering variable, and vi</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id_exp"</span>, <span class="st">"vi"</span>, <span class="va">retain_mods</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Train the model</span></span>
<span><span class="va">mf_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html" class="external-link">train</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">yi</span>,</span>
<span>               x <span class="op">=</span> <span class="va">X</span>,</span>
<span>               study <span class="op">=</span> <span class="st">"id_exp"</span>, <span class="co"># Name of the clustering variable</span></span>
<span>               method <span class="op">=</span> <span class="fu"><a href="../reference/ModelInfo_mf.html">ModelInfo_mf</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>               trControl <span class="op">=</span> <span class="va">grouped_cv</span>,</span>
<span>               tuneGrid <span class="op">=</span> <span class="va">tuning_grid</span>,</span>
<span>               num.trees <span class="op">=</span> <span class="fl">5000</span><span class="op">)</span></span>
<span><span class="co"># Examine optimal tuning parameters</span></span>
<span><span class="va">mf_cv</span><span class="op">$</span><span class="va">results</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.min</a></span><span class="op">(</span><span class="va">mf_cv</span><span class="op">$</span><span class="va">results</span><span class="op">$</span><span class="va">RMSE</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
<p>The object returned by <code>train</code> already contains the final
model, estimated with the best combination of tuning parameters.
Consequently, we can proceed directly to reporting the results. First,
we examine convergence again . Then, we examine the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>R</mi><mrow><mi>o</mi><mi>o</mi><mi>b</mi></mrow><mn>2</mn></msubsup><annotation encoding="application/x-tex">R^2_{oob}</annotation></semantics></math>.</p>
</div>
<div class="section level3">
<h3 id="inspecting-the-results">Inspecting the results<a class="anchor" aria-label="anchor" href="#inspecting-the-results"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># For convenience, extract final model</span></span>
<span><span class="va">final</span> <span class="op">&lt;-</span> <span class="va">mf_cv</span><span class="op">$</span><span class="va">finalModel</span></span>
<span><span class="co"># Extract R^2_{oob} from the final model</span></span>
<span><span class="va">r2_oob</span> <span class="op">&lt;-</span> <span class="va">final</span><span class="op">$</span><span class="va">forest</span><span class="op">$</span><span class="va">r.squared</span></span>
<span><span class="co"># Plot convergence</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">final</span><span class="op">)</span></span></code></pre></div>
<p>We can conclude that the model has converged, and has a positive
estimate of explained variance in new data. Now, we proceed to
interpreting the model findings. We will plot the variable importance,
and partial dependence plots.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot variable importance</span></span>
<span><span class="fu"><a href="../reference/VarImpPlot.html">VarImpPlot</a></span><span class="op">(</span><span class="va">final</span><span class="op">)</span></span>
<span><span class="co"># Sort the variable names by importance, so that the</span></span>
<span><span class="co"># partial dependence plots will be ranked by importance</span></span>
<span><span class="va">ordered_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">final</span><span class="op">$</span><span class="va">forest</span><span class="op">$</span><span class="va">variable.importance</span><span class="op">)</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">final</span><span class="op">$</span><span class="va">forest</span><span class="op">$</span><span class="va">variable.importance</span>, decreasing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co"># Plot partial dependence</span></span>
<span><span class="fu"><a href="../reference/PartialDependence.html">PartialDependence</a></span><span class="op">(</span><span class="va">final</span>, vars <span class="op">=</span> <span class="va">ordered_vars</span>,</span>
<span>                  rawdata <span class="op">=</span> <span class="cn">TRUE</span>, pi <span class="op">=</span> <span class="fl">.95</span><span class="op">)</span></span></code></pre></div>
<p>Because this is an exploratory, non-parametric analysis, we cannot
conclude whether any of these findings are “significant”. However, the
<code>PartialDependence</code> function has two settings that help
visualize the “importance” of a finding: <code>rawdata</code>, which
plots the weighted raw data (studies with larger weights are plotted
with a larger point size), thereby visualizing the variance around the
mean prediction, and <code>pi</code>, which plots a (e.g., 95%)
percentile interval of the predictions of individual trees in the model.
This is not the same as a confidence interval, but it does show how
variable or stable the model predictions are. This exploratory moderator
analysis could be followed with a linear regression model, focusing only
on relevant moderators identified by <code>MetaForest</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="more-information">More information<a class="anchor" aria-label="anchor" href="#more-information"></a>
</h2>
<p>The following open-access book chapter has a more elaborate tutorial,
including reporting guidelines:</p>
<p>Van Lissa, C. J. (2020). Small sample meta-analyses: Exploring
heterogeneity using MetaForest. In R. Van De Schoot &amp; M. Miočević
(Eds.), <em>Small Sample Size Solutions (Open Access): A Guide for
Applied Researchers and Practitioners.</em> CRC Press. <a href="https://doi.org/10.4324/9780429273872-16" class="external-link uri">https://doi.org/10.4324/9780429273872-16</a></p>
<p>Moreover, other applied examples of MetaForest analyses are available
in published papers, some of which have open data and syntax. For
instance, <a href="https://doi.org/10.1016/j.jesp.2018.02.014" class="external-link">Curry and
colleagues (2019)</a> used MetaForest to examine moderators of the
effect of acts of kindness on well-being, and found none. The full
syntax and data are available on Github; <a href="https://github.com/cjvanlissa/kindness_meta-analysis" class="external-link uri">https://github.com/cjvanlissa/kindness_meta-analysis</a>.
Secondly, <a href="https://doi.org/10.1016/j.neubiorev.2019.04.021" class="external-link">Bonapersona and
colleagues (2019)</a> used MetaForest to identify moderators of the
effect of early life adversity on the behavioral phenotype of animal
models. Their full syntax and data are available at <a href="https://osf.io/ra947/" class="external-link uri">https://osf.io/ra947/</a>.
Thirdly, <a href="https://doi.org/10.1002/ejsp.2889" class="external-link">Bialek and
colleagues</a> used MetaForest to examine moderators of the “mere
ownership” effect: People’s tendency to value what they own more than
what they do not own. There studies illustrate different applications of
MetaForest, and different reporting practices.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Caspar J. van Lissa.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
